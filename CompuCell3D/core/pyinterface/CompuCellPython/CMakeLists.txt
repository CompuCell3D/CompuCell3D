
if(${CMAKE_SYSTEM_NAME} STREQUAL Windows)

    if(${MSVC})
        # have to add /bigobj to visual studion compilation of hte CompuCell python module
        message ("THIS IS FLAGS ${CMAKE_CXX_FLAGS_RELWITHDEBINFO}")
        SET(CMAKE_CXX_FLAGS_RELWITHDEBINFO "${CMAKE_CXX_FLAGS_RELWITHDEBINFO} /bigobj")
        message ("AFTER THIS IS FLAGS ${CMAKE_CXX_FLAGS_RELWITHDEBINFO}")
                
    endif()

SET(LIBS
    CompuCellLibShared
    Field3DStatic
    BasicUtilsStatic
    PublicUtilitiesStatic
    UnitsStatic
    ${PYTHON_LIBRARY_TO_LINK}
)

else(${CMAKE_SYSTEM_NAME} STREQUAL Windows)

INCLUDE_DIRECTORIES(/usr/include)

SET(DOLFIN_LIBS )

if(USE_DOLFIN) 
    SET(DOLFIN_LIBS dolfin)
endif()

SET(LIBS
  CompuCellLibShared
  Field3DShared
  BasicUtilsShared
  PublicUtilitiesShared
  UnitsShared
  ${PYTHON_LIBRARY_TO_LINK}
  ${DOLFIN_LIBS}
)

endif(${CMAKE_SYSTEM_NAME} STREQUAL Windows)


SET(LIBS_AUX
    BiasVectorSteppableShared
    ImplicitMotilityShared
    PyPlugin
    ChemotaxisShared
    FocalPointPlasticityShared
    PlasticityTrackerShared
    PlasticityShared
    NeighborTrackerShared
    VolumeTrackerShared    
    CenterOfMassShared    
    PixelTrackerShared
    BoundaryPixelTrackerShared   
    MitosisShared
    MitosisSteppableShared
    ClusterSurfaceShared    
    ClusterSurfaceTrackerShared
    ElasticityTrackerShared
    ElasticityShared 
    ContactLocalFlexShared
    ContactLocalProductShared
    ContactMultiCadShared
    AdhesionFlexShared
    ConnectivityLocalFlexShared
    ConnectivityGlobalShared  
    LengthConstraintShared
    BoundaryMonitorShared
    MomentOfInertiaShared
    SecretionShared
    CellOrientationShared
    PolarizationVectorShared
    Polarization23Shared
    OrientedGrowthShared
    ContactOrientationShared
    CleaverMeshDumperShared

    # AutogeneratedModules - DO NOT REMOVE THIS LINE IT IS USED BY TWEDIT TO LOCATE CODE INSERTION POINT
    # CurvatureCalculator_autogenerated
    CurvatureCalculatorShared

)

INCLUDE_DIRECTORIES(
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${COMPUCELL3D_SOURCE_DIR}/core
    ${COMPUCELL3D_SOURCE_DIR}/core/CompuCell3D
    ${COMPUCELL3D_SOURCE_DIR}/core/CompuCell3D/plugins
    ${COMPUCELL3D_SOURCE_DIR}/core/pyinterface/PyPlugin
)

# configure compilation of modules for old and new player. Old player modules are compiled with ("threads"=0) option
# and new are compiled with ("threads"=1) option
# set(thread_option \(\"threads\"=1\))
# configure_file(${CMAKE_CURRENT_SOURCE_DIR}/CompuCell.i.in ${CMAKE_CURRENT_SOURCE_DIR}/CompuCell.i)

# set(thread_option )
# configure_file(${CMAKE_CURRENT_SOURCE_DIR}/CompuCell.i.in ${CMAKE_CURRENT_SOURCE_DIR}/CompuCellOld.i)

SET_SOURCE_FILES_PROPERTIES(CompuCell.i  PROPERTIES CPLUSPLUS ON)
# SET_SOURCE_FILES_PROPERTIES(CompuCellPython.i CompuCellAuxPython.i PROPERTIES SWIG_FLAGS "-includeall")
SWIG_ADD_LIBRARY(CompuCell LANGUAGE python SOURCES CompuCell.i)


if(${CMAKE_SYSTEM_NAME} STREQUAL Windows)
  # changes dll name to pyd sop that it is compatible with new Python standard
  SET_TARGET_PROPERTIES(CompuCell PROPERTIES SUFFIX ".pyd")
endif(${CMAKE_SYSTEM_NAME} STREQUAL Windows)

# SWIG_LINK_LIBRARIES(CompuCell ${LIBS} ${LIBS_AUX})
# todo - change back to include libs_aux
SWIG_LINK_LIBRARIES(CompuCell ${LIBS} ${LIBS_AUX})
set_target_properties(CompuCell PROPERTIES LINK_FLAGS ${undefined_link_flags})

if (APPLE)

   # interesting reading: https://blog.kitware.com/upcoming-in-cmake-2-8-12-osx-rpath-support/

   # INSTALL_NAME_DIR overrides MACOSX_RPATH.  Try not to do that.

   # Use rpath for CompuCell.so
   SET_TARGET_PROPERTIES(CompuCell PROPERTIES MACOSX_RPATH TRUE)

   # append directories in the linker search path and outside the project to the INSTALL_RPATH
   SET_TARGET_PROPERTIES(CompuCell PROPERTIES CMAKE_INSTALL_RPATH_USE_LINK_PATH TRUE)

   # this is where libraries on which CompuCell.so depends on are
   # installed relative to where CompuCell.py is installed
   SET_TARGET_PROPERTIES(CompuCell PROPERTIES INSTALL_RPATH "@loader_path/CompuCell3DPlugins;@loader_path/CompuCell3DSteppables;@loader_path/lib")


endif()


install(TARGETS CompuCell DESTINATION ${COMPUCELL3D_INSTALL_SWIG_MODULES_DIR} )

set(python_files_path ${CMAKE_BINARY_DIR}/core/pyinterface/CompuCellPython)

INSTALL(FILES ${python_files_path}/CompuCell.py 
	      DESTINATION ${COMPUCELL3D_INSTALL_SWIG_MODULES_DIR})


